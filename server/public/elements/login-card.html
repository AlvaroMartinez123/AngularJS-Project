<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">

<polymer-element name="login-card" attributes="showRegistered">
<template>
<style>
  #core_card {
  position: relative;
  width: 100%;
  height: auto;
  border:1px solid #191919;
  box-shadow: 0 5px 10px 5px rgba(0,0,0,0.2);
  color:white;
  background:#333 ;
  z-index: 1;
    border-bottom-right-radius: 5px;
  border-bottom-left-radius: 5px;

  /*opacity: .95;*/
}
  #register p {
  font-size: 100%;
  margin-left: 5px;
  font-weight: bold
}
#register {
  background:#1C1C1C;
  border-bottom-style: solid;
  border-bottom-color: white;
  border-bottom-width: 1px;
  
}
#container {
  width: 90%;
  height: auto;
  margin: 0px auto;
  text-align: center;
}
#paper_button {
  text-align: center;
  margin: 20px;
}
paper-input {
  margin-left: auto;
  margin-right: auto;
  width: 200px;
}
#facebook {
  border-bottom-width: 1px;
  border-bottom-style: solid;
  border-bottom-color: rgb(219, 224, 226);
}
#paper_button2{
  width:90%;
  margin-bottom: 10px;
  margin-top: 20px;
  position: relative;
  border:1px solid rgba(0,0,0,0.4);
  text-shadow:0 -1px 0 rgba(0,0,0,0.4);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.3),
    inset 0 10px 10px rgba(255,255,255,0.1);
  border-radius:0.3em;
  background:#0184ff;
  color:white;
  font-weight:bold;
  cursor:pointer;
  font-size:13px;
}
 #registered_card {
  position: absolute;
  width: 400px;
  height: 150px;
  border-radius-bottom:0.4em;
  border:1px solid #191919;
  box-shadow: 0 5px 10px 5px rgba(0,0,0,0.2);
  color:white;
  background:#333 ;


  /*opacity: .95;*/
}
#return{
  width:200px;
  position: relative;
  border:1px solid rgba(0,0,0,0.4);
  text-shadow:0 -1px 0 rgba(0,0,0,0.4);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.3),
    inset 0 10px 10px rgba(255,255,255,0.1);
  border-radius:0.3em;
  background:#0184ff;
  color:white;
  font-weight:bold;
  cursor:pointer;
  font-size:13px;
}
#sectionp {
  width: 420px;
  height: 100%;
  position: relative;
}
#paper_tabs {
  background:#1C1C1C;
  border-bottom-style: solid;
  border-bottom-color: white;
  border-bottom-width: 1px;
  font-size: 100%;
  font-weight: bold;
  color: white;
  width: 100%;
  border-top-right-radius: 5px;
  border-top-left-radius: 5px;
}
#section {
  height: auto;

}
#core_animated_pages {
  width: 100%;
  height: auto;
  position: relative;
  background-color: rgb(238, 238, 238);
  border-bottom-right-radius: 5px;
  border-bottom-left-radius: 5px;
}

#section2 {
  height: auto;
  position: relative;
}
#section3 {
  height: auto;
  position: relative;
}
#p3{
  border-bottom: 1px solid white;
  padding-bottom: 10px;
}
</style>
<div center-justified horizontal layout center>
<section id="sectionp">
    <paper-tabs noink nobar selected="0" selectedindex="0" id="paper_tabs" horizontal center layout>
      <paper-tab id="paper_tab" inline flex center-center horizontal layout active>REGISTER</paper-tab>
      <paper-tab id="paper_tab1" inline flex center-center horizontal layout>LOGIN</paper-tab>
    </paper-tabs>
    <section id="section" flex relative>
      <core-animated-pages selected="{{ $.paper_tabs.selected }}" lastselected="0" selectedindex="0" notap id="core_animated_pages">
          <section id="section2" layout horizontal center center-justified active>
            <core-card id="core_card" layout vertical hidden?="{{showRegistered}}">
              <div id="container">
                <div id="form">
                  <p id="p3">Create your account</p>
                  <paper-input label="Usename"  id="username" floatinglabel willvalidate layout vertical required></paper-input>
                  <paper-input  label="Password" type="password" floatinglabel willvalidate  id="password" layout vertical required></paper-input>
                  <paper-input label="Email" id="email" floatinglabel willvalidate layout vertical required></paper-input>
                  <paper-button label="Register" on-tap={{handleRegister}} id="paper_button2"></paper-button>
                </div>
              </div>
            </core-card>
          </section>
          <section id="section3"  layout horizontal center center-justified active>
            <core-card id="core_card" layout vertical hidden?="{{showRegistered}}">
              <div id="container">
                <div id="facebook"><paper-button label="Login with Facebook" id="paper_button"></paper-button></div>
                <div id="form">
                  <paper-input label="Usename"  id="username" floatinglabel willvalidate layout vertical required></paper-input>
                  <paper-input  label="Password" type="password" floatinglabel willvalidate  id="password" layout vertical required></paper-input>
                  <paper-button label="Login" on-tap={{handleRegister}} id="paper_button2"></paper-button>
                </div>
              </div>
            </core-card>
          </section>
      </core-animated-pages>
    </section>
</section>
</div>
  <core-card id="registered_card" layout vertical hidden?="{{!showRegistered}}">
    <div id="register" start-justified horizontal layout start>
      <p id="p">REGISTERED</p>
    </div>
    <div id="container">
    <p>Welcome to Rapidshot!</p>
    <paper-button label="Return" on-tap={{handleReturn}} id="return"></paper-button>
    </div>
  </core-card>
</template>

<script>
function doAjax(options, success, error) {
       options.type = options.type || 'GET';
       options.url = '/user' + (options.url || '');
       options.dataType = options.dataType || 'json';
       options.contentType = options.contentType || 'application/json; charset=UTF-8';
       options.success = success;
       if (socket.io.engine.id){
        options.url += '?socketId='+ socket.io.engine.id;
       }
       $.ajax(options);
     };

var users;

Polymer('login-card', {
        ready: function() {
        this.a="";
        this.b="";
      },
  showRegistered : false,
  handleRegister: function(){
    var name = this.$.username.value;
    var password = this.$.password.value;
    var email = this.$.email.value;

      this.newUser(name, password, email);
      this.showRegistered = !this.showRegistered;
      
    this.$.username.value = "";
    this.$.password.value = "";
    this.$.email.value = "";

  },
  handleReturn: function(){
      this.showRegistered = !this.showRegistered;
    },
    created: function() {
     if (!users) {
       doAjax({}, function(data) {
         users = data;
         this.users = users;
       }.bind(this));
     }
   },
  newUser: function(name, password, email) {
    var data = {
      name:name,
      password:password,
      email:email
    }
    doAjax({type: 'POST', url:'/', data:JSON.stringify(data)}, function(result){
      this.users.push(result);
    }.bind(this));
  },
  setUser: function(user, name){
    var data = {
      name:name,
      password:user.password,
      email:user.email,
      score:user.score
    }

    console.log(user._id);

    var url = '/' + user._id;
    doAjax({type: 'PUT', url:url, data:JSON.stringify(data)}, function(result){
      user.name = name;

    }.bind(this));
  },
  deleteUser: function(user) {
    var url = '/' + user._id;
    doAjax({type: 'DELETE', url:url}, function(result){
      var i = this.users.indexOf(user);
      if(i >= 0){
        this.scores.splice(i, 1);
      }
    }.bind(this));
  }

  });
</script>

</polymer-element>