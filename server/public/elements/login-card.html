<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">


<polymer-element name="login-card">
<template>
<style>
  #core_card {
  position: relative;
  width: 400px;
  height: 500px;
  border-radius:0.4em;
  border:1px solid #191919;
  box-shadow: 0 5px 10px 5px rgba(0,0,0,0.2);
  color:white;
  background:#333 ;
  z-index: 1;

  /*opacity: .95;*/
}
  #register p {
  font-size: 100%;
  margin-left: 5px;
  font-weight: bold
}
#register {
  background:#1C1C1C;
  border-bottom-style: solid;
  border-bottom-color: white;
  border-bottom-width: 1px;
  
}
#container {
  width: 90%;
  height: 100%;
  margin: 0px auto;
  text-align: center;
}
#paper_button {
  text-align: center;
  margin: 20px;
}
paper-input {
  margin-left: auto;
  margin-right: auto;
  width: 200px;
}
#facebook {
  border-bottom-width: 1px;
  border-bottom-style: solid;
  border-bottom-color: rgb(219, 224, 226);
}
#paper_button2{
  width:90%;
  margin-top: 20px;
  position: relative;
  border:1px solid rgba(0,0,0,0.4);
  text-shadow:0 -1px 0 rgba(0,0,0,0.4);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.3),
    inset 0 10px 10px rgba(255,255,255,0.1);
  border-radius:0.3em;
  background:#0184ff;
  color:white;
  font-weight:bold;
  cursor:pointer;
  font-size:13px;
}

</style>
	<core-card id="core_card" layout vertical>
		<div id="register" start-justified horizontal layout start>
      <p id="p">REGISTER FREE</p>
    </div>
    <div id="container">
      <div id="facebook">
        <paper-button label="Login with Facebook" id="paper_button"></paper-button>
      </div>
      <div id="form">
        <p id="p1">Create your account</p>
        <paper-input label="Usename"  id="username" floatinglabel willvalidate layout vertical ></paper-input>
        <paper-input  label="Password" type="password" floatinglabel willvalidate  id="password" layout vertical ></paper-input>
        <paper-input label="Email" id="email" floatinglabel willvalidate layout vertical ></paper-input>
        <paper-button label="Register" on-tap={{handleRegister}} id="paper_button2"></paper-button>
        <p id="p2">Have an account?</p>
      </div>

    </div>
	</core-card>
</template>

<script>
function doAjax(options, success, error) {
       options.type = options.type || 'GET';
       options.url = '/user' + (options.url || '');
       options.dataType = options.dataType || 'json';
       options.contentType = options.contentType || 'application/json; charset=UTF-8';
       options.success = success;

       $.ajax(options);
     }

var users;


Polymer('login-card', {
        ready: function() {
        this.a="";
        this.b="";
      },
     
  handleRegister: function(){
    var name = this.$.username.value;
    var password = this.$.password.value;
    var email = this.$.email.value;

      this.newUser(name, password, email);
    
    this.$.username.value = "";
    this.$.password.value = "";
    this.$.email.value = "";

  },
  created: function() {
     if (!users) {
       doAjax({}, function(data) {
         users = data;
         this.users = users;
       }.bind(this));
     }
   },
  newUser: function(name, password, email) {
    var data = {
      name:name,
      password:password,
      email:email
    }
    doAjax({type: 'POST', url:'/', data:JSON.stringify(data)}, function(result){
      this.users.push(result);
    }.bind(this));
  },
  setUser: function(user, name){
    var data = {
      name:name,
    }
    var url = '/:' + user.userId;
    doAjax({type: 'PUT', url:url, data:JSON.stringify(data)}, function(result){
      this.users.user[name] = name;
    }.bind(this));
  }
});
</script>

</polymer-element>